var e,t;1!=window.pulsado&&(window.versionPlugin="Plugin v94",window.chks=0,window.loc=location.origin,window.webActual=loc+location.pathname,window.ttl=document.title,document.title=versionPlugin,window.qs=function(e){return document.querySelector(e)},window.qsa=function(e){return document.querySelectorAll(e)},window.dameToken=function(){return $('meta[name="csrf-token"]').attr("content")},window.dameUserHash=async function(){var e=await cookieStore.get("userHash");return e?e.value:null},window.dameToken=async function(){var e=await cookieStore.get("token");return e?e.value:null},window.mostrarCaducidadLoginReservas=async function(){var e;chks%10==0&&((e=await(await fetch(loc+"/web/profile/myproducts")).text()).includes("Mi Perfil")?(e=e.split('id="res-').length-1,qs(".header").textContent="Tiene "+e+" reservas"):(qs(".header").textContent="NO hay sesión",console.log("no hay sesion")))},qs(".es-iam-menu-ppal-button:first-child").innerText="ReMAD "+versionPlugin),textoCaducaHoy=" (Caduca hoy)",1!=window.pulsado&&(window.tituloProducto=qs(".bigCard-title"),window.existeBotonReservar=qs("#boton-autoreservar"),window.contenedorBotones=qs(".card-actions"),e=null!=qs(".reservar-btn"),tituloProducto)&&!existeBotonReservar&&(window.reservableAlInicio=e,window.timeoutNormal=350,window.timeoutLento=750,window.timeoutRapido=150,window.modo=window.timeoutLento,window.deboComprobarSiCaducaHoy=!1,window.textoTituloProducto=tituloProducto?tituloProducto.textContent:"#producto#",reservableAlInicio&&((e=document.createElement("div")).className="_ngcontent-mia-c44",window.contenedorBotones.append(e),(t=document.createElement("button")).className="reservar-btn",t.id="boton-autoreservar",t.innerText="Reservar (sin SMS)",t.style="background-color: #e94e1b; color: #fff; border: none; border-radius: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer;",e.append(t),t.addEventListener("click",async function(){var e=await window.dameUserHash(),t=await window.dameToken(),o=location.hash.split("/").pop();null==t||null==e?alert("No hay sesión iniciada. Por favor, inicie sesión e inténtelo de nuevo."):(e=await(await fetch("https://remad.madrid.es/REMAD_RSP/api/v1/reservations?userHash="+e,{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+t},method:"POST",body:JSON.stringify({antiquity:{hash:o}})})).json(),alert(e.code),location.reload())})),window.pulsado=!0),pathNuevo=loc+"/./file/thumbnail",limiteReducido=50,limiteAmpliado=200,limiteTotal=1e6,timeout=450,idMasNuevo=0,idMasReciente=0,refrescarActivo=!1;let a={do:261.63,re:293.66,"re#":311.13,mi:329.63,fa:349.23,"fa#":369.99,sol:392,la:440,si:493.88,DO:523.25,"DO#":554.36,RE:587.33,"RE#":622.25,MI:659.25,FA:698.46,SOL:783.99,LA:880,SI:987.77,R:0};window.sonar=function(e,t,o,a){window.setTimeout(()=>{window.generarNota(e,t,a)},1e3*o)},window.contexto=null,window.generarNota=function(e,t,o=.5){null===contexto&&(window.contexto=new(window.AudioContext||window.webkitAudioContext));var a=contexto.createOscillator(),e=(a.type="triangle",a.frequency.setValueAtTime(e,contexto.currentTime),contexto.createGain()),r=contexto.currentTime,t=r+t;e.gain.setValueAtTime(0,r),e.gain.linearRampToValueAtTime(o,r+.05),e.gain.setValueAtTime(o,t-.1),e.gain.linearRampToValueAtTime(0,t),a.connect(e),e.connect(contexto.destination),a.start(r),a.stop(t+.01)},window.notificarEntertainer=function(){let o=0;[["re",.25],["re#",.25],["mi",.25],["DO",.5],["mi",.25],["DO",.5],["mi",.25],["DO",1]].forEach(([e,t])=>{e=a[e];window.sonar(e,t,o),o+=.85*t})},window.notificarBuenoFeoMalo=function(){let o=0;[["la",.25],["RE",.25],["la",.25],["RE",.25],["la",.75],["R",.25],["fa",.5],["R",.15],["sol",.5],["R",.2],["re",1],["R",.5]].forEach(([e,t])=>{e=a[e];window.sonar(e,t,o),o+=.65*t})},window.webrender=function(t){var o=dameToken();for(let e=0;e<t.data.length;e++){var a=t.data[e],a=$('<div class="thumbnail-container"><div class="thumbnail thumbnail-height"><a style="color:black;" href="'+loc+"/web/antiquity/"+a.id+'"><img src="'+pathNuevo+"/"+a.file_id+'" alt="" class="img-responsive"></a><div class="thumbnail-body"><h3><a style="color:black;" href="'+loc+"/web/antiquity/"+a.id+'">'+a.short_name+'</a></h3><p><span class="block-ellipsis"><strong>Categoría:</strong> '+a.category.name+'</span> <br><span class="block-ellipsis"><strong>Ubicación:</strong> '+a.plf.name+'</span></p></div><div class="thumbnail-action">'+("RESERVADO"==a.state?'<p class="pull-left" style="font-size: 17px;position: absolute;bottom: 40px;"><strong class="text-danger">Producto Reservado</strong><br>Hasta el '+a.expire_date+"</p>":'<form id="reserve-form-'+a.id+'" action="'+loc+"/web/antiquity/reserve/"+a.id+'" method="POST"><input type="hidden" name="_token" value="'+o+'"><input hidden="" name="g-recaptcha-response" id="recaptcha-'+a.id+'"><button type="button" onclick="reserveWithRecaptcha(\''+a.id+'\')" class="btn-danger btn-sm pull-left thumbnail-action-button" data-toggle="tooltip" data-placement="top" title="" data-bs-original-title="Click para reservar">Reservar</button></form>')+'<form action="'+loc+"/web/antiquity/favorite/"+a.id+'" method="POST"><input type="hidden" name="_token" value="'+o+'"><button type="submit" class="thumbnail-action-button-right" style="border-color: transparent; background-color: transparent; color: #dc4405;" data-toggle="tooltip" data-placement="top"title="Click para '+(a.favorite?"eliminar de favoritos":"añadir a favoritos")+'"><i class="fa '+(a.favorite?"fa-heart":"fa-heart-o")+' fa-2x"></i></button></form></div></div></div>');$("#results").append(a)}},window.comprobarArticulo=function(e,t){var o=new Date;let a=o.getDate(),r=o.getMonth()+1;o=o.getFullYear(),a<10&&(a="0"+a),r<10&&(r="0"+r),o=a+"/"+r+"/"+o;0<=t.innerText.indexOf(o)?t.classList.remove("hide"):t.classList.add("hide")},window.verArticulos=function(t){qs("#btn-show-more").classList.add("bloqueado"),qs("#btn-show-much-more").classList.add("bloqueado");var e=dameToken(),o={},a=(0==t?(o.start=0,o.limit=limiteTotal):(o.start=qsa("#results>div").length,o.limit=t),$("#plf").val());a&&"none"!=a&&(o.plf_id=a),qs("#category option[value='home']").selected&&(o.home="checked"),qs("#category option[value='child']").selected&&(o.child="checked"),qs("#category option[value='sport']").selected&&(o.sport="checked"),qs("#available").checked&&(o.available="checked"),$.ajaxSetup({headers:{"X-CSRF-TOKEN":e}}),$.ajax({method:"POST",url:loc+"/web/catalogue/more",dataType:"json",data:o,success:function(e){0==t?(borrarResultados(),qs("#btn-show-more").classList.add("bloqueado"),qs("#btn-show-much-more").classList.add("bloqueado")):(qs("#btn-show-more").classList.remove("bloqueado"),qs("#btn-show-much-more").classList.remove("bloqueado")),0<e.data.length&&webrender(e),idPrimerArticulo=parseInt(qs("#results .thumbnail-container a").href.split("/").slice(-1)[0])},error:function(e){}})},window.fncFiltrarCaducanHoy=function(){var t=qsa("#results>div");if(qs("#caducahoy").checked)for(let e=0;e<t.length;e++){var o=t[e];comprobarArticulo(e,o)}else for(let e=0;e<t.length;e++)t[e].classList.remove("hide")},window.fncInvertirOrden=function(){var e=qs("#results");qs("#invertir").checked?e.classList.add("invertir"):e.classList.remove("invertir")},window.replicarNodo=function(e){var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)},window.agregarBotonera=function(){replicarNodo(qs("#btn-show-more"));var e=qs("#btn-show-more"),t=(e.innerText="Ver "+limiteReducido+" Más",e.addEventListener("click",verArticulos.bind(this,limiteReducido)),e.cloneNode(!0));t.innerText="Ver "+limiteAmpliado+" Más",t.id="btn-show-much-more",t.addEventListener("click",verArticulos.bind(this,limiteAmpliado)),e.parentNode.append(t);let o=qs("#available").parentNode;o.className="form-group col-xs-6 col-md-2",replicarNodo(o),(o=qs("#available").parentNode).querySelector("label").htmlFor="available";e=document.createElement("div"),e.className="form-group col-xs-6 col-md-2",o.parentNode.append(e),t=document.createElement("span"),t.className="btn btn-outline",t.innerText="Buscar "+limiteReducido,t.id="boton-buscar-limite",e.append(t),t.addEventListener("click",reemplazarDisponibles.bind(this,limiteReducido)),e=document.createElement("div"),e.className="form-group col-xs-6 col-md-2",o.parentNode.append(e),t=document.createElement("span"),t.className="btn btn-outline",t.innerText="Buscar Todo",t.id="boton-buscar-todo",e.append(t),t.addEventListener("click",reemplazarDisponibles.bind(this,0)),e=qs("#plf").parentNode,replicarNodo(e),t=qs("#category").parentNode,qs("#category").style.display=null,(bsmultiselect=qs(".dashboardcode-bsmultiselect"))&&bsmultiselect.remove(),(opciontodos=qs("#category option[value='all']"))&&opciontodos.remove(),replicarNodo(t.parentNode),qs("#category option[value='home']").selected=!0,qs("#category option[value='child']").selected=!0,qs("#category option[value='sport']").selected=!0,$("#category.form-control").bsMultiSelect(),qs("#home").remove(),qs("#child").remove(),qs("#sport").remove(),e=o.cloneNode(!0),t=e.querySelector("input"),t.name="caducahoy",t.id="caducahoy",t.checked=!1,t=e.querySelector("label"),t.textContent="Caducan hoy:",t.htmlFor="caducahoy",o.parentNode.append(e),$("#caducahoy").on("click",fncFiltrarCaducanHoy),t=o.cloneNode(!0),e=t.querySelector("input"),e.name="invertir",e.id="invertir",e.checked=!1,e=t.querySelector("label"),e.textContent="Orden inverso:",e.htmlFor="invertir",o.parentNode.append(t),$("#invertir").on("click",fncInvertirOrden),e=document.createElement("div"),e.className="form-group col-xs-6 col-md-2",o.parentNode.append(e),t=document.createElement("span"),t.className="btn btn-outline",t.id="boton-auto-refrescar",t.innerText="Auto Refrescar",e.append(t),t.addEventListener("click",iniciarAutoRefrescar),e=document.createElement("div"),e.className="form-group col-xs-6 col-md-2",o.parentNode.append(e),t=document.createElement("span"),t.className="btn btn-outline",t.id="boton-auto-capturar",t.innerText="Auto Capturar",e.append(t),t.addEventListener("click",iniciarAutoCapturar),e=document.createElement("style");e.innerHTML=`#results{display:flex;flex-direction:row;flex-wrap:wrap;}
#results.invertir{flex-direction:row-reverse;flex-wrap:wrap-reverse;}
#results>div{display:block;flex-basis:33%;position:relative;padding:15px;}
#results .reservado form button[type='submit']{background-color:#18bc9c;pointer-events:none;}
#results .reservado>div{border:2px dashed #18bc9c;}
#results .perdido form button[type='submit']{background-color:black;pointer-events:none;}
#results .perdido>div{border:2px dashed black;}
.bloqueado {border:2px dashed silver;color:silver;pointer-events:none;}
@media only screen and (max-width:1000px){#results>div{flex-basis:50%;padding:5px;}}
@media only screen and (max-width:768px){#results>div{flex-basis:100%;padding:2px;}}`,document.getElementsByTagName("head")[0].appendChild(e)},window.borrarResultados=function(){var t=qsa("#results>div");for(let e=0;e<t.length;e++)t[e].remove();var e=qs("#caducahoy"),e=(e&&null!=e&&(e.checked=!1),qs("#invertir"));e&&null!=e&&(e.checked=!1)},window.reemplazarDisponibles=function(e){borrarResultados(),verArticulos(e)},window.iniciarAutoRefrescar=async function(){chks=0,refrescarActivo?(refrescarActivo=!1,qs("#boton-auto-refrescar").textContent="Auto Refrescar",qs("#boton-auto-capturar").classList.remove("bloqueado"),qs("#btn-show-more").classList.remove("bloqueado"),qs("#btn-show-much-more").classList.remove("bloqueado"),qs("#boton-buscar-limite").classList.remove("bloqueado"),qs("#boton-buscar-todo").classList.remove("bloqueado")):(refrescarActivo=!0,qs("#boton-auto-refrescar").textContent="DETENER Auto Refrescar",qs("#boton-auto-capturar").classList.add("bloqueado"),qs("#btn-show-more").classList.add("bloqueado"),qs("#btn-show-much-more").classList.add("bloqueado"),qs("#boton-buscar-limite").classList.add("bloqueado"),qs("#boton-buscar-todo").classList.add("bloqueado")),window.capturar=!1,comprobarReservaCatalogo()},window.iniciarAutoCapturar=async function(){chks=0,refrescarActivo?(refrescarActivo=!1,qs("#boton-auto-capturar").textContent="Auto Capturar",qs("#boton-auto-refrescar").classList.remove("bloqueado")):(refrescarActivo=!0,qs("#boton-auto-capturar").textContent="DETENER Auto Capturar",qs("#boton-auto-refrescar").classList.add("bloqueado")),window.capturar=!0,comprobarReservaCatalogo()},window.comprobarReservaCatalogo=async function(){var e=dameToken(),t={start:0,limit:limiteReducido},o=$("#plf").val(),o=(o&&"none"!=o&&(t.plf_id=o),qs("#category option[value='home']").selected&&(t.home="checked"),qs("#category option[value='child']").selected&&(t.child="checked"),qs("#category option[value='sport']").selected&&(t.sport="checked"),qs("#available").checked&&(t.available="checked"),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e}}),t=await(await fetch(loc+"/web/catalogue/more",o)).json();let a=0,r=(t.data[0].id>idMasNuevo&&(idMasNuevo=t.data[0].id,0<chks)&&"PUBLICADO"==t.data[0].state&&(window.notificarBuenoFeoMalo(),1==window.capturar)&&(a=idMasNuevo),chks++,mostrarCaducidadLoginReservas(),!1);if(t.data.forEach((e,t)=>{e.fecha_act=new Date(e.updated_at),e.id==idMasReciente&&(r=!0)}),t.data.sort((e,t)=>t.fecha_act-e.fecha_act),t.data[0].id!=idMasReciente&&(idMasReciente=t.data[0].id,1==r)&&window.notificarEntertainer(),borrarResultados(),webrender(t),1==window.capturar&&0<a&&qs("#results .thumbnail-container form[action$='"+a+"'] button").click(),refrescarActivo){try{(tituloCatalogo=qs(".container .row h1")).textContent=textoTituloCatalogo+" - "+chks}catch(e){}try{document.title=ttl+" "+chks}catch(e){}setTimeout(comprobarReservaCatalogo,timeout)}else{try{(tituloCatalogo=qs(".container .row h1")).textContent=textoTituloCatalogo}catch(e){}try{document.title=ttl}catch(e){}}},1!=window.pulsado&&(resultadosCatalogo=qs("#results"))&&(textoTituloCatalogo=qs(".container .row h1").textContent,qs("#results").insertAdjacentHTML("afterend",'<div class="row" id="results2"></div>'),null==qs("#caducahoy")&&agregarBotonera(),reemplazarDisponibles(limiteReducido),window.pulsado=!0);